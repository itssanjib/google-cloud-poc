# gcp-db-migration-poc
POC on google cloud for database migration for MySQL as well as PostgreSQL

## Configuration
Configure properties file as per requirement.

In application.properties add service account's email id.

In private key json file add private key as well as add service account's email id.

## CURL
curl -X POST \
  http://localhost:8080/migrate/mysql/sql_dump \
  -H 'Authorization: "N/A"' \
  -H 'Content-Type: application/json' \
  -H 'Postman-Token: 8d0d6710-514f-4d6d-8153-74ab9ffb602c,6c7026ae-210b-4b0b-bbb9-082ab383f6a6' \
  -H 'cache-control: no-cache,no-cache'

# Manual steps to hit the APT through Postman.

## Step 1:
      To call the access token API we need to generate the jwt token and send along with it. To generate the jwt token we will use the jwt.io site and put the required values in the Decoded section like below.
          HEADER:
                  {
                    "alg": "RS256"
                  }
      
          PAYLOAD:
                  {
                    "iss": "<service account email>",
                    "scope": "https://www.googleapis.com/auth/cloud-platform https://www.googleapis.com/auth/compute                                         https://www.googleapis.com/auth/compute.readonly",
                    "aud": "https://oauth2.googleapis.com/token",
                    "iat": 1581315185,
                    "exp": 1581316185
                  }
                  
          VERIFY SIGNATURE:
                  -----BEGIN PRIVATE KEY-----
                  <Private Key>
                  ----END PRIVATE KEY-----
                  
                  
## Step 2:
      We will take the ENCODED jwt token from the step 1 and use the curl to get the access token.
      
      curl -X POST \
        https://oauth2.googleapis.com/token \
        -H 'Accept: */*' \
        -H 'Accept-Encoding: gzip, deflate' \
        -H 'Cache-Control: no-cache' \
        -H 'Connection: keep-alive' \
        -H 'Content-Length: 827' \
        -H 'Content-Type: application/x-www-form-urlencoded' \
        -H 'Host: oauth2.googleapis.com' \
        -H 'Postman-Token: 7cb98a91-4ae6-4bf2-98eb-3681c01836d3,6fbdb4b2-5d79-4a96-a704-367b00fa796f' \
        -H 'User-Agent: PostmanRuntime/7.20.1' \
        -H 'cache-control: no-cache' \
        -d 'grant_type=urn%3Aietf%3Aparams%3Aoauth%3Agrant-type%3Ajwt-bearer&assertion=<jwt token>'
        
## Step 3:
      We will call the main API by using he access token generated by the step 2.
      
      curl --header "Authorization: Bearer ${ACCESS_TOKEN}" \
     --header 'Content-Type: application/json' \
     --data @./data.json \
     -X POST \
     https://www.googleapis.com/sql/v1beta4/projects/myProject/instances/myInstance/users
